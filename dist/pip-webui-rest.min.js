!function(){"use strict";var e=angular.module("pipDataCache",["pipDataModel"]);e.provider("pipDataCache",function(){function e(e){return e&&(n=e),n}var n=3e5,t={};this.timeout=e,this.$get=["$q","pipDataModel",function(r,i){function o(e){var n={};null!=e&&(n.item=e.item,n.party_id=e.party_id,n.search=e.search,n.paging=e.paging,n.take=e.take,n.skip=e.skip),n=angular.toJson(n);var t,r,i,o=0;if(null==n||0===n.length)return o;for(t=0,i=n.length;t<i;t++)r=n.charCodeAt(t),o=(o<<5)-o+r,o|=0;return o}function a(e,n){var t=o(n);return e+(0!=t?"_"+t:"")}function s(e){if(null==e)t={};else for(var n in t)(n==e||n.startsWith(e+"_"))&&delete t[n]}function u(e,r){if(null==e)throw new Error("name cannot be null");if(""==e)throw new Error("name cannot be empty");var i=a(e,r),o=t[i];return null==o?null:o.expire&&_.now()-o.expire>n?(delete t[i],null):o.data}function E(e,n,r){if(null==e)throw new Error("name cannot be null");if(""==e)throw new Error("name cannot be empty");t[a(e,r)]={expire:_.now(),data:n}}function c(e,n,r){if(null==e)throw new Error("name cannot be null");if(""==e)throw new Error("name cannot be empty");t[a(e,r)]={expire:null,data:n}}function p(e,n){if(null==e)throw new Error("name cannot be null");if(""==e)throw new Error("name cannot be empty");delete t[a(e,n)]}function d(e,n,t){if(null==e)throw new Error("name cannot be null");if(null!=n){var r=u(e,t);if(null!=r){for(var i=!1,o=0;o<r.length;o++)if(r[o].id==n.id)return r[o]=n,void(i=!0);i||r.push(n),E(e,r,t)}}}function l(e,n,t){if(null==e)throw new Error("params cannot be null");var o=e.cache||e.resource,a=e.filter,s=!!e.force,c=s?null:u(o,e),p=r.defer();return c?(a&&(c.data?c.data=a(c.data):c=a(c)),n&&n(c),p.resolve(c),p.promise):(1==e.item.paging?i.page(e,function(t){E(o,t,e),a&&(t.data=a(t.data)),p.resolve(t),n&&n(t)},function(e){p.reject(e),t&&t(e)}):i[e.singleResult?"readOne":"read"](e,function(t){e.singleResult?d(o,t,e):E(o,t,e),a&&(t=a(t)),p.resolve(t),n&&n(t)},function(e){p.reject(e),t&&t(e)}),p.promise)}function T(e,n){if(null==e)throw new Error("name cannot be null");if(null!=n)for(var r in t)if(r==e||r.startsWith(e+"_")){var i=t[r].data;if(angular.isArray(i))for(var o=0;o<i.length;o++)i[o].id==n.id&&(i.splice(o,1),o--)}}function f(e,n,t){return function(r){T(e,n),t&&t(r)}}function S(e,n,r){return function(n){for(var i in t)if(i==e||i.startsWith(e+"_")){var o=t[i].data;if(angular.isArray(o))for(var a=0;a<o.length;a++)o[a].id==n.id&&(o[a]=n)}r&&r(n)}}function m(e,n,t){return function(r){n&&n.notClearedCache||s(e),t&&t(r)}}return{timeout:e,clear:s,retrieve:u,retrieveOrLoad:l,store:E,storePermanent:c,remove:p,removeItem:T,removeDecorator:f,addDecorator:m,updateDecorator:S}}]})}(),function(){"use strict";var e=angular.module("pipSessionCache",["pipCore","pipRest","pipDataCache"]);e.run(["$rootScope","pipSessionCache",function(e,n){e.$on("pipSessionOpened",n.init),e.$on("pipSessionClosed",n.clear)}]),e.service("pipSessionCache",["$rootScope","$stateParams","$q","pipTranslate","pipRest","localStorageService","pipAccess","pipEnums","pipSession","pipDataCache",function(e,n,t,r,i,o,a,s,u,E){function c(e,n,t){return e=e||{},E.retrieveOrLoad(e,n,t)}function p(n,t){if(null==t)throw new Error("Unexpected error: issues in openning session");d(),t.serverUrl&&(e.$serverUrl=t.serverUrl),f(t.user,null)}function d(){E.clear(),delete e.$user,delete e.$party,delete e.$serverUrl,delete e.$connection,delete e.$settings}function l(n,t){n=n||E.retrieve("user"),t=t||E.retrieve("party"),null!=n&&(n=null==t?a.asOwner(n):n.id==t.id?a.asOwner(n):a.toParty(n,t),E.storePermanent("user",n),e.$user=n)}function T(n){if(n){var t=n.theme||"blue";n&&e.$party&&(t=e.$party.id==n.id?n.theme:"navy"),e.$theme=t,o.set("theme",t)}}function f(n){null!=n&&(E.storePermanent("user",n),e.$user=n,T(n),r.use(n.language,!1,!0),l(n,null))}function S(e,n){if(!u.opened())throw new Error("User is not authenticated.");var r=u.userId(),o=E.retrieve("user");if(o){if(o.id!=r)throw new Error("Unexpected error: issues in opening session");e&&e(o);var a=t.defer();return a.resolve(o),a.promise}return i.users().get({id:r},function(n){n.id!=r,f(n),e&&e(use)},n).$promise}function m(n,r,o){if(!u.opened())throw new Error("User is not authenticated.");var a=u.userId(),s=n.party_id||a,c=E.retrieve("party");if(c&&c.id==s){e.$party=c,T(e.$user),r&&r(c);var p=t.defer();return p.resolve(c),p.promise}return i.parties().get({id:s},function(n){l(null,n),E.storePermanent("party",n),e.$party=n,T(e.$user),r&&r(n)},o).$promise}function A(n,r,o){if(!u.opened())throw new Error("User is not authenticated.");var a=u.userId(),c=n.party_id||a,p=E.retrieve("connection");if(!p||p.party_id==a&&p.to_party_id==c||(p=null,E.remove("connection"),delete e.$connection),a==c){r&&r(p);var d=t.defer();return d.resolve(p),d.promise}return i.connections().query({party_id:a,to_party_id:c,accept:s.ACCEPTANCE.ACCEPTED},function(n){p=n&&n.length>0?n[0]:null,E.storePermanent("connection",p),e.$connection=p,r&&r(p)},o).$promise}function O(n,r){if(!u.opened())throw new Error("User is not authenticated.");var o=u.userId(),a=E.retrieve("settings_"+o);if(a){n&&n(a);var s=t.defer();return s.resolve(a),s.promise}return i.partySettings().get({party_id:o},function(t){t=t||{},E.storePermanent("settings_"+o,t),e.$settings=t,n&&n(t)},r).$promise}function N(n,t){if(null!=n){var r=u.userId(),i=E.retrieve("settings_"+r);i&&(i=_.extend(i,n),E.storePermanent("settings_"+r,i),e.$settings=i),t&&t(n)}}return{init:p,clear:d,readUser:S,readParty:m,readConnection:A,readSettings:O,onSettingsUpdate:N,readSessions:c}}])}(),function(){"use strict";var e=angular.module("pipRest.Access",["pipUtils","pipRest.Enums"]);e.factory("pipAccess",["pipUtils","pipEnums",function(e,n){function t(e){var t=_.defaults({id:e.id||e._id,party_id:null,party_name:null,type:null,owner:!1,manager:!1,contributor:!1,share_level:n.SHARE_LEVEL.WORLD},e);return delete t._id,t}function r(e){return e.manager=e.manager||e.owner,e.contributor=e.contributor||e.manager,e.contributor&&(e.share_level=n.SHARE_LEVEL.PRIVATE),e}function i(e,t){return e.party_id=t.party_id,e.party_name=t.party_name,e.type=t.type,e.owner=!!t.owner,e.manager=!!t.manager,e.contributor=!!t.contributor,e.share_level=t.share_level||n.SHARE_LEVEL.WORLD,t.party&&(e.party_id=t.party.id||t.party._id,e.party_name=t.party.name),r(e)}function o(e){if(null!=e){var r=t(e);return r.party_id=r.id,r.party_name=r.name,r.type=null,r.owner=!0,r.manager=!0,r.contributor=!0,r.share_level=n.SHARE_LEVEL.PRIVATE,r}}function a(n,i){if(null!=n){if(null==i)return o(n);var a=n.id||n._id,s=i.id||i._id||i,u=i.name||n.name;if(a==s)return o(n);var E=t(n);return E.party_id=s,E.party_name=u,_.each(E.party_access,function(n){e.equalObjectIds(s,n.party_id)&&(E.party_name=n.party_name,E.type=n.type,E.manager=E.manager||n.manager,E.contributor=E.contributor||n.contributor,E.share_level=Math.max(E.share_level,n.share_level))}),r(E)}}function s(e,n){if(null!=e){var r=t(e);return n&&i(r,n),r}}function u(e,n,t){var r=a(e,n);return t&&i(r,t),r}return{asOwner:o,toParty:a,override:s,toPartyWithOverride:u}}])}(),function(){"use strict";var e=angular.module("pipRest.State",["pipState","pipRest.Session","pipRest.Access","pipSessionCache"]);e.config(["$locationProvider","$httpProvider",function(e,n){n.interceptors.push("pipAuthHttpResponseInterceptor")}]),e.run(["$rootScope","pipState","pipSession","pipAuthState",function(e,n,t,r){function i(i,o,a,s,u){if(!r.redirect(i,o,a,e)){if((o.auth||void 0===o.auth)&&!t.opened()){i.preventDefault();var E=n.href(o.name,a);return E.length>0&&"#"==E[0]&&(E=E.substring(1)),void r.goToSignin({redirect_to:E,toState:o,toParams:a})}return o.name==r.signoutState()?(i.preventDefault(),t.signout(),void r.goToUnauthorized({})):o.name==r.unauthorizedState()&&t.opened()?(i.preventDefault(),void r.goToAuthorized({})):void 0}}function o(e,n){t.close(),r.goToSignin(n)}function a(e,n){r.goToErrors("errors_maintenance",n)}function s(e,n){r.goToErrors("errors_no_connection",n)}function u(e,n){r.goToErrors("errors_missing_route",n)}function E(e,n){r.goToErrors("errors_unknown",n)}e.$on("$stateChangeStart",i),e.$on("pipUnauthorizedRedirect",o),e.$on("pipMaintenanceError",a),e.$on("pipNoConnectionError",s),e.$on("pipMissingRouteError",u),e.$on("pipUnknownError",E)}]),e.factory("pipAuthHttpResponseInterceptor",["$q","$location","$rootScope",function(e,n,t){return{response:function(n){return 401===n.status&&console.error("Response 401"),n||e.when(n)},responseError:function(r){var i=t.$state&&t.$state.name?t.$state.name:null,o=t.$state&&t.$state.params?t.$state.params:null;switch(r.status){case 401:case 440:console.error("Response Error 401",r),t.$emit("pipUnauthorizedRedirect",{redirect_to:i&&o&&o.redirect_to?"":n.url(),toState:i,toParams:o});break;case 503:t.$emit("pipMaintenanceError",{error:r}),console.error("errors_maintenance",r);break;case-1:t.$user&&t.$party||t.$emit("pipNoConnectionError",{error:r}),console.error("errors_no_connection",r);break;default:console.error("errors_unknown",r)}return e.reject(r)}}}]),e.provider("pipAuthState",["pipStateProvider",function(e){function n(e){return e&&(c=e),c}function t(e){return e&&(p=e),p}function r(e){return e&&(d=e),d}function i(e){return e&&(l=e),l}function o(n,t){if(null==n)throw new Error("stateName cannot be null");if(null==t)throw new Error("stateConfig cannot be null");return(t.auth||t.authenticate)&&(t.resolve=t.resolve||{},t.resolve.user=a,t.resolve.party=s,t.resolve.connection=u,t.resolve.setting=E),e.state(n,t),this}function a(e){return e.readUser()}function s(e,n){return e.readParty(n)}function u(e,n){return e.readConnection(n)}function E(e){return e.readSettings()}a.$inject=["pipSessionCache"],s.$inject=["pipSessionCache","$stateParams"],u.$inject=["pipSessionCache","$stateParams"],E.$inject=["pipSessionCache"];var c=null,p=null,d="/",l="/";this.signinState=n,this.signoutState=t,this.authorizedState=r,this.unauthorizedState=i,this.redirect=e.redirect,this.state=o,this.$get=["pipState",function(e){return e.signinState=function(){return c},e.signoutState=function(){return p},e.authorizedState=function(){return d},e.unauthorizedState=function(){return l},e.goToErrors=function(n,t){if(null==n)throw new Error("Error state was not defined");e.go(n,t)},e.goToSignin=function(n){if(null==c)throw new Error("Signin state was not defined");e.go(c,n)},e.goToSignout=function(n){if(null==p)throw new Error("Signout state was not defined");e.go(p,n)},e.goToAuthorized=function(n){if(null==d)throw new Error("Authorized state was not defined");e.go(d,n)},e.goToUnauthorized=function(n){if(null==l)throw new Error("Unauthorized state was not defined");e.go(l,n)},e}]}])}(),function(){"use strict";var e=angular.module("pipRest.Enums",[]);e.factory("pipEnums",function(){function e(e){var n=[];for(var t in e)e.hasOwnProperty(t)&&n.push(e[t]);return n}var n={};return n.SHARE_LEVEL={WORLD:0,OUTER:1,INNER:2,PRIVATE:3},n.URGENCY={LOW:1,NORMAL:500,HIGH:1e3,MIN:0,MAX:1e3},n.URGENCIES=e(n.URGENCY),n.IMPORTANCE={LOW:1,NORMAL:500,HIGH:1e3,MIN:0,MAX:1e3},n.IMPORTANCES=e(n.IMPORTANCE),n.CONFIDENTIALITY={PUBLIC:0,SENSITIVE:1,CLASSIFIED:2,SECRET:3},n.CONFIDENTIALITIES=e(n.CONFIDENTIALITY),n.LEVEL={NONE:0,LOW:1,LOW_MEDIUM:250,MEDIUM:500,MEDIUM_HIGH:750,HIGH:1e3,MIN:0,MAX:1e3},n.LANGUAGE={ENGLISH:"en",SPANISH:"es",PORTUGUESE:"pt",FRENCH:"fr",GERMAN:"de",RUSSIAN:"ru"},n.LANGUAGES=e(n.LANGUAGE),n.STAT_TYPE={DAILY:"daily",MONTHLY:"monthly",YEARLY:"yearly",TOTAL:"total"},n.STAT_TYPES=e(n.STAT_TYPE),n.STAT_BATCH_OPERATION={RECORD_SYSTEM_STATS:"record system stats",RECORD_PARTY_STATS:"record party stats"},n.SERVER_TYPE={REALTIME_DB:"r/t db master",HISTORIAN_DB:"db slave",ANALYTICS:"analytics",BUSINESS_LOGIC:"business logic",REST_API:"rest api",STATIC_CONTENT:"static content",BACKUP_STORAGE:"backup storage"},n.SERVER_TYPES=e(n.SERVER_TYPE),n.SYSTEM_LOG_TYPE={INFO:"info",STOP:"stop",START:"start",RESTART:"restart",UPGRADE:"upgrade",MAINTENANCE:"maintenance",WARNING:"warning",ERROR:"error"},n.SYSTEM_LOG_TYPES=e(n.SYSTEM_LOG_TYPE),n.ACTIVITY_TYPE={SIGNUP:"signup",SIGNIN:"signin",PASSWORD_CHANGED:"password changed",PWD_RECOVERED:"pwd recovered",EMAIL_VERIFIED:"email verified",SETTINGS_CHANGED:"settings changed",PARTNERED:"partnered",TEAMED_UP:"teamed up",FOLLOWED:"followed",DISCONNECTED:"disconnected",CREATED:"created",UPDATED:"updated",DELETED:"deleted",ACCEPTED:"accepted",REJECTED:"rejected",JOINED:"joined",COMPLETED:"completed",CANCELED:"canceled",PROGRESS:"progress",POSTED:"posted",BUZZED:"buzzed",COMMENTED:"commented",CHEERED:"cheered",BOOED:"booed"},n.ACTIVITY_TYPES=e(n.ACTIVITY_TYPE),n.REFERENCE_TYPE={PARTY:"party",CONNECTION:"connection",CONTACT:"contact",MESSAGE:"message",NOTE:"note",AREA:"area",GOAL:"goal",EVENT:"event",VISION:"vision",COLLAGE:"collage",POST:"post",SUPPORT_CASE:"support case",ANNOUNCE:"announce",IMAGE_SET:"image set",FEEDBACK:"feedback",GUIDE:"guide"},n.REFERENCE_TYPES=e(n.REFERENCE_TYPE),n.CONTENT_TYPE={TEXT:"text",CHECKLIST:"checklist",LOCATION:"location",TIME:"time",PICTURES:"pictures",DOCUMENTS:"documents"},n.CONTENT_TYPES=e(n.CONTENT_TYPE),n.PARTY_TYPE={PERSON:"person",TEAM:"team",AGENT:"agent"},n.PARTY_TYPES=e(n.PARTY_TYPE),n.GENDER={MALE:"male",FEMALE:"female",NOT_SPECIFIED:"n/s"},n.GENDERS=e(n.GENDER),n.VISION_TYPE={OVERALL:"overall",ROLE:"role",MODEL:"model",TIME:"time"},n.VISION_TYPES=e(n.VISION_TYPE),n.AREA_TYPE={CATEGORY:"category",AREA:"area"},n.AREA_TYPES=e(n.AREA_TYPE),n.GOAL_TYPE={GOAL:"goal",OBJECTIVE:"objective",DREAM:"dream",ACCOMPLISHMENT:"accomplishment",TASK:"task",ROUTINE:"routine"},n.GOAL_TYPES=e(n.GOAL_TYPE),n.PROCESS_NODE={START:"start",END:"end",EVENT:"event",AWAIT:"await",DECISION:"decision",ACTIVITY:"activity"},n.PROCESS_NODES=e(n.PROCESS_NODE),n.CALCULATION_METHOD={LAST_VALUE:"last value",SUM:"sum",MAX:"max",MIN:"min",AVERAGE:"average"},n.CALCULATION_METHODS=e(n.CALCULATION_METHOD),n.EXECUTION_STATUS={NEW:"new",ASSIGNED:"assigned",IN_PROGRESS:"in progress",VERIFYING:"verifying",ON_HOLD:"on hold",CANCELED:"canceled",COMPLETED:"completed"},n.EXECUTION_STATUSES=e(n.EXECUTION_STATUS),n.CONTRIBUTOR_ROLE={UNDEFINED:"undefined",RESPONSIBLE:"responsible",ACCOUNTABLE:"accountable",CONSULTED:"consulted",INFORMED:"informed"},n.CONSTRIBUTOR_ROLES=e(n.CONTRIBUTOR_ROLE),n.ACCEPTANCE={JOINED:"joined",INVITED:"invited",ACCEPTED:"accepted"},n.ACCEPTANCES=e(n.ACCEPTANCE),n.ACCEPT_ACTION={INVITE:"invite",JOIN:"join",ACCEPT:"accept",REJECT:"reject"},n.ACCEPT_ACTIONS=e(n.ACCEPT_ACTION),n.JOIN_METHOD={INVITE:"invite",APPROVE:"approve",OPEN:"open"},n.JOIN_METHODS=e(n.JOIN_METHOD),n.SKILL_LEVEL={NOVICE:"novice",INTERMEDIATE:"intermediate",ADVANCED:"advanced",EXPERT:"expert"},n.SKILL_LEVELS=e(n.SKILL_LEVEL),n.FEEDBACK_TYPE={SUPPORT:"support",TEAM:"team",MEETUP:"meetup",COPYRIGHT:"copyright",BUSINESS:"business",ADVERTISEMENT:"ad"},n.FEEDBACK_TYPES=e(n.FEEDBACK_TYPE),n.NOTE_CATEGORY={GENERAL:"general",UNFINISHED:"unfinished",ULTIMATE_TODO:"ultimate todo"},n.NOTE_CATEGORIES=e(n.NOTE_CATEGORY),n.CONNECTION_TYPE={PARTNER:"partner",MEMBER:"member",FOLLOW:"follow",AUTOMATION:"automation"},n.CONNECTION_TYPES=e(n.CONNECTION_TYPE),n.EVENT_TYPE={INSTANCE:"instance",RECURRENCE:"recurrence",AUTO_INSTANCE:"auto",TIME_ENTRY:"time entry"},n.EVENT_TYPES=e(n.EVENT_TYPE),n.EVENT_CATEGORY={DAILY:"daily",WEEKLY:"weekly",MONTHLY:"monthly",YEARLY:"yearly"},n.EVENT_CATEGORIES=e(n.EVENT_CATEGORY),n.COMMENT_TYPE={BUZZ:"buzz",CHEER:"cheer",BOO:"boo",COMMENT:"comment"},n.COMMENT_TYPES=e(n.COMMENT_TYPE),n.POST_TYPE={INFO:"info",QUESTION:"question",ISSUE:"issue",REPORT:"report",FORECAST:"forecast"},n.POST_TYPES=e(n.POST_TYPE),n.MESSAGE_TYPE={REGULAR:"regular",EMAIL:"email",INVITATION:"invitation"},n.MESSAGE_TYPES=e(n.MESSAGE_TYPE),n.NOTIFICATION_TYPE={GREETING:"greeting",MESSAGE:"message",PARTNER_INVITE:"partner invite",PARTNER_RESPONSE_ACCEPTED:"partner response accepted",PARTNER_RESPONSE_REJECTED:"partner response rejected",PARTNER_JOINED:"partner joined",MEMBER_INVITE:"member invite",MEMBER_REQUEST:"member request",MEMBER_RESPONSE_ACCEPTED:"member response accepted",MEMBER_RESPONSE_REJECTED:"member response rejected",MEMBER_JOINED:"member joined",FOLLOWER_JOINED:"follower joined",ENTITY_REQUEST:"entity request",ENTITY_REQUEST_ACCEPTED:"entity request accepted",ENTITY_REQUEST_REJECTED:"entity request rejected",ENTITY_INVITE:"entity invite",ENTITY_INVITE_ACCEPTED:"entity invite accepted",ENTITY_INVITE_REJECTED:"entity invite rejected",ENTITY_JOINED:"entity joined",VERIFY_EMAIL:"verify email",COMPLETE_PROFILE:"complete profile"},n.NOTIFICATION_TYPES=e(n.NOTIFICATION_TYPE),n.NOTIFICATION_BATCH_OPERATION={CREATE:"create",REPLY:"reply",CLOSE:"close",DELETE:"delete"},n.SUPPORT_CASE_CATEGORY={ACCOUNT:"account",BILLING:"billing",TECHNICAL:"technical",GENERAL:"general"},n.SUPPORT_CASE_CATEGORIES=e(n.SUPPORT_CASE_CATEGORY),n.ANNOUNCE_TYPE={APP:"app",EMAIL:"email",APP_AND_EMAIL:"app and email"},n.ANNOUNCE_TYPES=e(n.ANNOUNCE_TYPE),n.ANNOUNCE_CATEGORY={GENERAL:"general",MAINTENANCE:"maintenance",NEW_RELEASE:"new release",SURVEY:"survey"},n.ANNOUNCE_CATEGORIES=e(n.ANNOUNCE_CATEGORY),n.GUIDE_TYPE={INTRO:"intro",TOPIC:"topic",CONTEXT:"context",TIP:"tip",NEW_RELEASE:"new release"},n.GUIDE_TYPES=e(n.GUIDE_TYPE),n.EMAIL_TYPE={HOME:"home",WORK:"work",OTHER:"other"},n.EMAIL_TYPES=e(n.EMAIL_TYPE),n.ADDRESS_TYPE={HOME:"home",WORK:"work",OTHER:"other"},n.ADDRESS_TYPES=e(n.ADDRESS_TYPE),n.ADDRESS_TYPE={HOME:"home",WORK:"work",OTHER:"other"},n.ADDRESS_TYPES=e(n.ADDRESS_TYPE),n.PHONE_TYPE={MOBILE:"mobile",WORK:"work",HOME:"home",MAIN:"main",WORK_FAX:"work fax",HOME_FAX:"home fax",OTHER:"other"},n.PHONE_TYPES=e(n.PHONE_TYPE),n.MESSANGER_TYPE={SKYPE:"skype",GOOGLE_TALK:"google talk",AIM:"aim",YAHOO:"yahoo",QQ:"qq",MSN:"msn",ICQ:"icq",JABBER:"jabber",OTHER:"other"},n.MESSANGER_TYPES=e(n.MESSANGER_TYPE),n.WEB_ADDRESS_TYPE={PROFILE:"profile",BLOG:"blog",HOME_PAGE:"home page",WORK:"work",PORTFOLIO:"portfolio",OTHER:"other"},n.WEB_ADDRESS_TYPES=e(n.WEB_ADDRESS_TYPE),n.DASHBOARD_TILE_SIZE={SMALL:"small",WIDE:"wide",LARGE:"large"},n.DASHBOARD_TILE_SIZES=e(n.DASHBOARD_TILE_SIZE),n})}(),function(){"use strict";var e=angular.module("pipRest",["ngResource","pipRest.Enums","pipRest.Access","pipRest.Session","pipRest.State"]);e.provider("pipRest",["$httpProvider",function(e){function n(e){for(var n in e)i[n]=e[n]}var t="",r=!1,i=[];this.addApi=n,this.version=function(n){return n&&(e.defaults.headers.common["api-version"]=n),e.defaults.headers.common["api-version"]},this.serverUrlFixed=function(e){return e!==!0&&"on"!==e||(r=e),r},this.serverUrl=function(e){return e&&(t=e),e},this.$get=["$rootScope","$http","$resource","$stateParams",function(n,o,a,s){function u(e,n,r,i){return e=e||t,a(e+n,r,i)}function E(e,n){return e=e||t,a(e+n,{},{call:{method:"POST"}})}function c(e,n,r){return e=e||t,a(e+n,r||{id:"@id"},{update:{method:"PUT"}})}function p(e,n,r){return e=e||t,a(e+n,r||{id:"@id"},{page:{method:"GET",isArray:!1},update:{method:"PUT"}})}function d(e,n,t){return p(e,n,t||{id:"@id",party_id:"@party_id"})}function l(){for(var e in i)T[e]=i[e]}var T={version:function(n){return n&&(e.defaults.headers.common["api-version"]=n),e.defaults.headers.common["api-version"]},serverUrl:function(e){return e&&(t=e),t},userId:function(){return o.defaults.headers.common["user-id"]},serverUrlFixed:function(){return r},sessionId:function(){return o.defaults.headers.common["session-id"]},partyId:function(){return s?s.party_id||o.defaults.headers.common["user-id"]:o.defaults.headers.common["user-id"]},about:function(e){return u(e,"/api/about")},session:function(e,n){o.defaults.headers.common["session-id"]=n,o.defaults.headers.common["user-id"]=e},signin:function(e){return E(e,"/api/signin")},signout:function(e){return E(e,"/api/signout")},signup:function(e){return E(e,"/api/signup")},recoverPassword:function(e){return E(e,"/api/recover_password")},resetPassword:function(e){return E(e,"/api/reset_password")},changePassword:function(e){return E(e,"/api/change_password")},requestEmailVerification:function(e){return c(e,"/api/users/:party_id/resend_email_verification")},verifyEmail:function(e){return E(e,"/api/verify_email")},signupValidate:function(e){return E(e,"/api/signup_validate")},users:function(e){return p(e,"/api/users/:id")},currentUser:function(e){return u(e,"/api/users/current",{},{get:{method:"GET",isArray:!1}})},userSessions:function(e){return d(e,"/api/users/:party_id/sessions/:id")},parties:function(e){return p(e,"/api/parties/:id")},partySettings:function(e){return d(e,"/api/parties/:party_id/settings")},serverActivities:function(e){return p(e,"/api/servers/activities/:id")},guides:function(e){return p(e,"/api/guides/:id")},tips:function(e){return p(e,"/api/tips/:id")},image_sets:function(e){return p(e,"/api/image_sets/:id")},images:function(e){return p(e,"/api/images/search")},feedbacks:function(e){return d(e,"/api/feedbacks/:id")},announces:function(e){return p(e,"/api/announcements/:id")},createResource:u,createOperation:E,createCollection:c,createPagedCollection:p,createPartyCollection:d};return l(),T}]}])}(),function(){"use strict";var e=angular.module("pipRest.Session",["ngCookies","pipRest"]);e.run(["pipSession",function(e){e.reopen()}]),e.factory("pipSession",["$rootScope","$http","localStorageService","$cookieStore","pipRest","pipTimer",function(e,n,t,r,i,o){function a(){return O}function s(){return A}function u(){return N||t.get("serverUrl")}function E(){var e=""!==A&&null!==A&&void 0!==A&&""!==O&&null!==O&&void 0!==O&&""!==N&&null!==N&&void 0!==N;return e}function c(e){var n=t.get("servers");if(n&&n[e])return n[e].email}function p(){return t.get("servers")||{}}function d(){var e,n=t.get("servers"),r=[];for(var i in n)n.hasOwnProperty(i)&&(e=n[i].serverUrl,e&&r.push(e));return r}function l(t,r,o){var a=t.serverUrl,s=t.email,u=t.password,E=t.remember,c=!!t.adminOnly,p=(new Date).getTime();R=p,n.defaults.headers.common["session-id"]=void 0,n.defaults.headers.common["user-id"]=void 0,n.defaults.headers.common["account-id"]=void 0,i.signin(a).call({email:s,password:u,remember:E},function(n){R==p&&(R=void 0,c&&!n.admin?o("ERROR_ADMIN_ONLY_ACCESS"):(S(a,n,E),e.$broadcast("pipAutoPullChanges"),r(n)))},function(e){R==p&&(R=void 0,o(e))})}function T(){R=void 0}function f(e){E()&&i.signout().call({},e,e),_()}function S(a,s,u){if(A=s.last_session_id,O=s.id,N=a,n.defaults.headers.common["session-id"]=A,n.defaults.headers.common["user-id"]=O,u){var E=t.get("servers")||{};E[N]={serverUrl:N,email:s.email},t.set("servers",E),t.set("sessionId",A),t.set("userId",O),t.set("serverUrl",N)}r.put("user-id",O),r.put("session-id",A),r.put("server-url",N),i.serverUrlFixed()||i.serverUrl(N),e.$emit("pipSessionOpened",{serverUrl:N,sessionId:A,userId:O,user:s}),o.start()}function m(){O=r.get("user-id")||t.get("userId"),A=r.get("session-id")||t.get("sessionId"),N=r.get("server-url")||t.get("serverUrl"),n.defaults.headers.common["session-id"]=A,n.defaults.headers.common["user-id"]=O,i.serverUrlFixed()&&i.serverUrl()||i.serverUrl(N),e.$serverUrl=i.serverUrl(),e.$emit("pipSessionOpened",{serverUrl:N,sessionId:A,userId:O}),o.start()}function _(){A=void 0,O=void 0,n.defaults.headers.common["session-id"]=void 0,n.defaults.headers.common["user-id"]=void 0,t.remove("userId"),t.remove("sessionId"),r.remove("user-id"),r.remove("session-id"),o.stop(),e.$emit("pipSessionClosed")}var A,O,N,R=void 0;return{opened:E,userId:a,sessionId:s,serverUrl:u,lastUsedEmail:c,usedServers:p,usedServerUrls:d,signin:l,abort:T,signout:f,open:S,close:_,reopen:m}}])}(),function(){"use strict";angular.module("pipData",["pipDataModel","pipDataCache","pipSessionData"])}(),function(){"use strict";var e=angular.module("pipDataModel",["pipUtils","pipRest"]);e.provider("pipDataModel",function(){this.$get=["$stateParams","pipCollections","pipRest",function(e,n,t){function r(e,n,t){var r,i=e.transaction;if(!i||e.skipTransactionBegin||(r=e.transactionId=i.begin(e.transactionOperation||"PROCESSING")))return d[e.resource]()[e.operation](e.item,function(t){i&&r&&i.aborted(r)||(i&&!e.skipTransactionEnd&&i.end(),n&&n(t))},function(e){i&&i.end(e),t&&t(e)})}function i(e,n,t){return e.transactionOperation=e.transactionOperation||"SAVING",e.operation=e.operation||"save",r(e,function(t){e.itemCollection&&e.itemCollection.push(t),n&&n(t)},function(e){t&&t(e)})}function o(e,t,i){return e.transactionOperation=e.transactionOperation||"SAVING",e.operation=e.operation||"update",r(e,function(r){e.itemCollection&&n.replaceBy(e.itemCollection,"id",r.id,r),t&&t(r)},i)}function a(e,n,t){return e.transactionOperation=e.transactionOperation||"SAVING",e.operation=e.operation||"remove",r(e,function(t){e.itemCollection&&_.remove(e.itemCollection,{id:t.id||(e.object||{}).id||(e.item||{}).id}),n&&n(t)},t)}function s(e,n,t){return e.transactionOperation=e.transactionOperation||"READING",e.operation=e.operation||"query",r(e,function(e){n&&n(e)},t)}function u(e,n,t){return e.transactionOperation=e.transactionOperation||"READING",e.operation=e.operation||"page",r(e,function(t){if(e.itemCollection&&t){var r=_.findIndex(e.itemCollection,{id:t.id});r>=0?e.itemCollection[r]=t:e.itemCollection.push(t)}n&&n(t)},t)}function E(e,n,t){return e.transactionOperation=e.transactionOperation||"READING",e.operation=e.operation||"page",r(e,function(t){if(e.itemCollection&&t.data)for(var r=0;r<t.data.length;r++)e.itemCollection.push(t.data[r]);n&&n(t)},t)}function c(e,n,t){var r,i=e.transaction;if(!i||e.skipTransactionBegin||(r=e.transactionId=i.begin(e.transactionOperation||"SAVING"))){var o=[{pictures:e.pictures,documents:e.documents}];if(e.item&&e.item.content){var a=!0;async.eachSeries(_.union(e.item.content,o),function(e,n){e.pictures||e.documents?e.pictures?e.pictures.save(function(){i&&r&&i.aborted(r)&&(a=!1,n("aborted")),e.documents?e.documents.save(function(){i&&r&&i.aborted(r)&&(a=!1,n("aborted")),n()},function(e){a=!1,n(e)}):n()},function(e){a=!1,n(e)}):e.documents&&e.documents.save(function(){i&&r&&i.aborted(r)&&(a=!1,n("aborted")),n()},function(e){a=!1,n(e)}):n()},function(r){!r&&a?(i&!e.skipTransactionEnd&&i.end(),_.each(e.item.content,function(e){delete e.pictures,delete e.documents}),n&&n()):(i&&i.end(r),t&&t(r))})}else e.pictures?e.pictures.save(function(){i&&r&&i.aborted(r)||(e.documents?e.documents.save(function(){i&&r&&i.aborted(r)||(i&!e.skipTransactionEnd&&i.end(),n&&n())},function(e){i&&i.end(e),t&&t(e)}):(i&!e.skipTransactionEnd&&i.end(),n&&n()))},function(e){i&&i.end(e),t&&t(e)}):e.documents?e.documents.save(function(){i&&r&&i.aborted(r)||(i&!e.skipTransactionEnd&&i.end(),n&&n())},function(e){i&&i.end(e),t&&t(e)}):(i&!e.skipTransactionEnd&&i.end(),n&&n())}}function p(e){e.pictures&&e.pictures.abort(),e.documents&&e.documents.abort(),e.transaction&&e.transaction.abort()}var d=[];for(var l in t)d[l]=t[l];return{execute:r,create:i,update:o,save:o,delete:a,remove:a,read:s,query:s,readOne:u,get:u,page:E,readPage:E,queryPage:E,saveFiles:c,abortFiles:p}}]})}(),function(){"use strict";var e=angular.module("pipSessionData",["pipRest","pipSessionCache"]);e.provider("pipSessionData",function(){function e(e){return e.readUser()}function n(e,n){return e.readParty(n)}function t(e,n){return e.readConnection(n)}function r(e){return e.readSettings()}function i(e,n,t){return n.userSessions().query({party_id:e.id}).$promise}function o(e,n){return n.sessionId()}e.$inject=["pipSessionCache"],n.$inject=["pipSessionCache","$stateParams"],t.$inject=["pipSessionCache","$stateParams"],r.$inject=["pipSessionCache"],i.$inject=["$stateParams","pipRest","$rootScope"],o.$inject=["$stateParams","pipSession"],this.readUserResolver=e,this.readPartyResolver=n,this.readConnectionResolver=t,this.readSettingsResolver=r,this.readSessionsUserResolver=i,this.readSessionIdResolver=o,this.$get=["$rootScope","$stateParams","pipRest","pipDataModel","pipSessionCache",function(e,n,t,r,i){function o(e){return function(){return e.sessionId()}}function a(e,r,i,o){var a=e.begin("REMOVING");a&&t.userSessions().remove({id:r.id,party_id:n.id},function(n){e.aborted(a)||(e.end(),i&&i(n))},function(n){e.end(n),o&&o(n)})}return{getSessionId:o,removeSession:a,readSessionsUser:function(e,t,r){return e.resource="userSessions",e.item=e.item||{},e.item.party_id=n.id,e.party_id=n.id,i.readSessions(e,t,r)}}}]})}();