!function(){"use strict";var e=angular.module("pipDataCache",["pipDataModel"]);e.provider("pipDataCache",function(){function e(e){return e&&(t=e),t}var t=3e5,n={};this.timeout=e,this.$get=["$q","pipDataModel",function(r,i){function a(){n={}}function o(e){if(null==e)throw new Error("name cannot be null");if(""==e)throw new Error("name cannot be empty");var r=n[e];return null==r?null:r.expire&&_.now()-r.expire>t?(delete n[e],null):r.data}function s(e,t){if(null==e)throw new Error("name cannot be null");if(""==e)throw new Error("name cannot be empty");n[e]={expire:_.now(),data:t}}function u(e,t){if(null==e)throw new Error("name cannot be null");if(""==e)throw new Error("name cannot be empty");n[e]={expire:null,data:t}}function c(e){if(null==e)throw new Error("name cannot be null");if(""==e)throw new Error("name cannot be empty");delete n[e]}function p(e,t,n){if(null==e)throw new Error("params cannot be null");var a=e.cache||e.resource;e&&null!==e.party_id&&void 0!==e.party_id?a=a+"_"+e.party_id:e&&e.item&&null!==e.item.party_id&&void 0!==e.item.party_id&&(a=a+"_"+e.item.party_id);var u=e.filter,c=!!e.force,p=c?null:o(a);if(p)return u&&(p=u(p)),t&&t(p),p;var d=r.defer();return i[e.singleResult?"readOne":"read"](e,function(n){e.singleResult?l(a,n):s(a,n),u&&(n=u(n)),d.resolve(n),t&&t(n)},function(e){d.reject(e),n&&n(e)}),d.promise}function d(e,t,n){if(null==e)throw new Error("name cannot be null");if(null!=n){var r=o(e);null==r&&(r=[]);for(var i=-1,a=0;a<r.length;a++)if(r[a].id==n.id){i=a;break}-1==i?r.push(n):r[a]=n,s(e,r)}}function E(e,t,n){return function(r){var i,a;t&&t.party_id?i="_"+t.party_id:t&&t.item&&t&&t.item.party_id&&(i="_"+t.item.party_id),a=e+i,l(a,t,r),n&&n(r)}}function l(e,t,n){if(null==e)throw new Error("name cannot be null");if(null!=n){var r=o(e);if(null!=r){for(var i=!1,a=0;a<r.length;a++)if(r[a].id==n.id)return r[a]=n,void(i=!0);i||r.push(n),s(e,r)}}}function T(e,t,n){return function(r){var i,a;t&&t.party_id?i="_"+t.party_id:t&&t.item&&t&&t.item.party_id&&(i="_"+t.item.party_id),a=e+i,l(a,t,r),n&&n(r)}}function f(e,t,n){if(null==e)throw new Error("name cannot be null");if(null!=n){var r=o(e);if(null!=r){for(var i=0;i<r.length;i++)r[i].id==n.id&&(r.splice(i,1),i--);s(e,r)}}}function m(e,t,n){return function(r){var i,a;t&&t.party_id?i="_"+t.party_id:t&&t.item&&t&&t.item.party_id&&(i="_"+t.item.party_id),a=e+i,f(a,t,t.item),n&&n(r)}}return{timeout:e,clear:a,retrieve:o,retrieveOrLoad:p,store:s,storePermanent:u,remove:c,addItem:d,updateItem:l,removeItem:f,addDecorator:E,updateDecorator:T,removeDecorator:m}}]})}(),function(){"use strict";var e=angular.module("pipSessionCache",["pipCore","pipRest","pipDataCache"]);e.run(["$rootScope","pipSessionCache",function(e,t){e.$on("pipSessionOpened",t.init),e.$on("pipSessionClosed",t.clear)}]),e.service("pipSessionCache",["$rootScope","$stateParams","$q","pipTranslate","pipRest","localStorageService","pipAccess","pipEnums","pipSession","pipDataCache",function(e,t,n,r,i,a,o,s,u,c){function p(t,n){if(null==n)throw new Error("Unexpected error: issues in openning session");d(),n.serverUrl&&(e.$serverUrl=n.serverUrl),T(n.user,null)}function d(){c.clear(),delete e.$user,delete e.$party,delete e.$serverUrl,delete e.$connection,delete e.$settings}function E(t,n){t=t||c.retrieve("user"),n=n||c.retrieve("party"),null!=t&&(t=null==n?o.asOwner(t):t.id==n.id?o.asOwner(t):o.toParty(t,n),c.storePermanent("user",t),e.$user=t)}function l(t){if(t){var n=t.theme||"blue";t&&e.$party&&(n=e.$party.id==t.id?t.theme:"navy"),e.$theme=n,a.set("theme",n)}}function T(t){null!=t&&(c.storePermanent("user",t),e.$user=t,l(t),r.use(t.language,!1,!0),E(t,null))}function f(e,t){if(!u.opened())throw new Error("User is not authenticated.");var n=u.userId(),r=c.retrieve("user");if(r){if(r.id!=n)throw new Error("Unexpected error: issues in openning session");return e&&e(r),r}return i.users().get({id:n},function(t){t.id!=n,T(t),e&&e(use)},t).$promise}function m(t,n,r){if(!u.opened())throw new Error("User is not authenticated.");var a=u.userId(),o=t.party_id||a,s=c.retrieve("party");return s&&s.id==o?(e.$party=s,l(e.$user),n&&n(s),s):i.parties().get({id:o},function(t){E(null,t),c.storePermanent("party",t),e.$party=t,l(e.$user),n&&n(t)},r).$promise}function S(t,n,r){if(!u.opened())throw new Error("User is not authenticated.");var a=u.userId(),o=t.party_id||a,p=c.retrieve("connection");return!p||p.party_id==a&&p.to_party_id==o||(p=null,c.remove("connection"),delete e.$connection),a==o?(n&&n(p),p):i.connections().query({party_id:a,to_party_id:o,accept:s.ACCEPTANCE.ACCEPTED},function(t){p=t&&t.length>0?t[0]:null,c.storePermanent("connection",p),e.$connection=p,n&&n(p)},r).$promise}function g(t,r){if(!u.opened())throw new Error("User is not authenticated.");var a=u.userId(),o=c.retrieve("settings_"+a);if(o){t&&t(o);var s=n.defer();return s.resolve(o),s.promise}return i.partySettings().get({party_id:a},function(n){n=n||{},c.storePermanent("settings_"+a,n),e.$settings=n,t&&t(n)},r).$promise}function R(t,n){if(null!=t){var r=u.userId(),i=c.retrieve("settings_"+r);i&&(i=_.extend(i,t),c.storePermanent("settings_"+r,i),e.$settings=i),n&&n(t)}}return{init:p,clear:d,readUser:f,readParty:m,readConnection:S,readSettings:g,onSettingsUpdate:R}}])}(),function(){"use strict";var e=angular.module("pipTagsCache",["pipUtils","pipDataCache"]);e.service("pipTagsCache",["pipTags","pipDataCache",function(e,t){function n(n,r){var i=r?e.extractTags(r):[];if(0!=i.length){var a="partyTags";n&&null!==n.party_id&&void 0!==n.party_id?a=a+"_"+n.party_id:n&&n.item&&null!==n.item.party_id&&void 0!==n.item.party_id&&(a=a+"_"+n.item.party_id);var o=t.retrieve(a);o&&(_.each(i,function(t){var n=_.find(o.tags,function(n){return e.equalTags(n.tag,t)});n?(n.tag=t,n.count=n.count+1,n.used=new Date):(o.tags||(o.tags=[]),o.tags.push({tag:t,count:1,used:new Date}))}),t.store(a,o))}}function r(e,t){return function(r){n(e,r),t&&t(r)}}function i(e,n,r){return e.resource="partyTags",e.singleResult=!0,t.retrieveOrLoad(e,n,r)}function a(e,t){return r(e,t)}return{readTags:i,onTagsUpdate:a,tagsUpdateDecorator:r}}])}(),function(){"use strict";var e=angular.module("pipAnnouncesData",["pipRest","pipDataModel"]);e.provider("pipAnnouncesData",function(){this.readAnnouncesResolver=function(){return["$stateParams","pipRest","pipEnums",function(e,t,n){return t.announces().query().$promise}]},this.readCompletedAnnouncesResolver=function(){return["$stateParams","pipRest","pipEnums",function(e,t,n){return t.announces().query({status:n.EXECUTION_STATUS.COMPLETED}).$promise}]},this.readAnnounceResolver=function(){return["$stateParams","pipRest",function(e,t){return t.announces().get({id:e.id}).$promise}]},this.$get=["pipRest","$stateParams","pipDataModel",function(e,t,n){return{partyId:e.partyId,updateAnnounce:function(e,t,r){e.resource="announces",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,t,r)},updateAnnounceWithFiles:function(e,t,r){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="announces",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,t,r)})},createAnnounceWithFiles:function(e,t,r){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="announces",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.create(e,t,r)})},createAnnounce:function(e,t,r){e.resource="announces",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.create(e,t,r)},deleteAnnounce:function(e,t,r){e.resource="announces",n.remove(e,t,r)}}}]})}(),function(){"use strict";angular.module("pipData",["pipDataModel","pipDataCache","pipUsersData","pipSettingsData","pipSessionData","pipTagsData","pipAnnouncesData","pipFeedbacksData","pipGuidesData","pipImageSetsData","pipTipsData"])}(),function(){"use strict";var e=angular.module("pipDataModel",["pipUtils","pipRest"]);e.provider("pipDataModel",function(){this.$get=["$stateParams","pipCollections","pipRest",function(e,t,n){function r(e,t,n){var r,i=e.transaction;if(!i||e.skipTransactionBegin||(r=e.transactionId=i.begin(e.transactionOperation||"PROCESSING")))return E[e.resource]()[e.operation](e.item,function(n){i&&r&&i.aborted(r)||(i&&!e.skipTransactionEnd&&i.end(),t&&t(n))},function(e){i&&i.end(e),n&&n(e)})}function i(e,t,n){return e.transactionOperation=e.transactionOperation||"SAVING",e.operation=e.operation||"save",r(e,function(n){e.itemCollection&&e.itemCollection.push(n),t&&t(n)},function(e){n&&n(e)})}function a(e,n,i){return e.transactionOperation=e.transactionOperation||"SAVING",e.operation=e.operation||"update",r(e,function(r){e.itemCollection&&t.replaceBy(e.itemCollection,"id",r.id,r),n&&n(r)},i)}function o(e,t,n){return e.transactionOperation=e.transactionOperation||"SAVING",e.operation=e.operation||"remove",r(e,function(n){e.itemCollection&&_.remove(e.itemCollection,{id:n.id||(e.object||{}).id||(e.item||{}).id}),t&&t(n)},n)}function s(e,t,n){return e.transactionOperation=e.transactionOperation||"READING",e.operation=e.operation||"query",r(e,function(e){t&&t(e)},n)}function u(e,t,n){return e.transactionOperation=e.transactionOperation||"READING",e.operation=e.operation||"page",r(e,function(n){if(e.itemCollection&&n){var r=_.findIndex(e.itemCollection,{id:n.id});r>=0?e.itemCollection[r]=n:e.itemCollection.push(n)}t&&t(n)},n)}function c(e,t,n){return e.transactionOperation=e.transactionOperation||"READING",e.operation=e.operation||"page",r(e,function(n){if(e.itemCollection&&n.data)for(var r=0;r<n.data.length;r++)e.itemCollection.push(n.data[r]);t&&t(n)},n)}function p(e,t,n){var r,i=e.transaction;if(!i||e.skipTransactionBegin||(r=e.transactionId=i.begin(e.transactionOperation||"SAVING"))){var a=[{pictures:e.pictures,documents:e.documents}];if(e.item&&e.item.content){var o=!0;async.eachSeries(_.union(e.item.content,a),function(e,t){e.pictures||e.documents?e.pictures?e.pictures.save(function(){i&&r&&i.aborted(r)&&(o=!1,t("aborted")),e.documents?e.documents.save(function(){i&&r&&i.aborted(r)&&(o=!1,t("aborted")),t()},function(e){o=!1,t(e)}):t()},function(e){o=!1,t(e)}):e.documents&&e.documents.save(function(){i&&r&&i.aborted(r)&&(o=!1,t("aborted")),t()},function(e){o=!1,t(e)}):t()},function(r){!r&&o?(i&!e.skipTransactionEnd&&i.end(),_.each(e.item.content,function(e){delete e.pictures,delete e.documents}),t&&t()):(i&&i.end(r),n&&n(r))})}else e.pictures?e.pictures.save(function(){i&&r&&i.aborted(r)||(e.documents?e.documents.save(function(){i&&r&&i.aborted(r)||(i&!e.skipTransactionEnd&&i.end(),t&&t())},function(e){i&&i.end(e),n&&n(e)}):(i&!e.skipTransactionEnd&&i.end(),t&&t()))},function(e){i&&i.end(e),n&&n(e)}):e.documents?e.documents.save(function(){i&&r&&i.aborted(r)||(i&!e.skipTransactionEnd&&i.end(),t&&t())},function(e){i&&i.end(e),n&&n(e)}):(i&!e.skipTransactionEnd&&i.end(),t&&t())}}function d(e){e.pictures&&e.pictures.abort(),e.documents&&e.documents.abort(),e.transaction&&e.transaction.abort()}var E=[];for(var l in n)E[l]=n[l];return{execute:r,create:i,update:a,save:a,"delete":o,remove:o,read:s,query:s,readOne:u,get:u,page:c,readPage:c,queryPage:c,saveFiles:p,abortFiles:d}}]})}(),function(){"use strict";var e=angular.module("pipFeedbacksData",["pipRest","pipDataModel"]);e.provider("pipFeedbacksData",function(){this.readFeedbacksResolver=function(){return["$stateParams","pipRest",function(e,t){return t.feedbacks().query().$promise}]},this.readFeedbackResolver=function(){return["$stateParams","pipRest",function(e,t){return t.feedbacks().get({id:e.id}).$promise}]},this.$get=["$stateParams","pipRest","pipDataModel",function(e,t,n){return{sendFeedback:function(e,t,r){e.resource="feedbacks",n.create(e,t,r)},createFeedbackWithFiles:function(e,t,r){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="feedbacks",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.create(e,t,r)})},updateFeedback:function(e,t,r){e.resource="feedbacks",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,t,r)},deleteFeedback:function(e,t,r){e.resource="feedbacks",n.remove(e,t,r)}}}]})}(),function(){"use strict";var e=angular.module("pipGuidesData",["pipRest","pipDataModel"]);e.provider("pipGuidesData",function(){this.readGuidesResolver=function(){return["$stateParams","pipRest",function(e,t){return t.guides().query().$promise}]},this.readIntroGuidesResolver=function(){return["$stateParams","pipRest",function(e,t){return t.guides().query({type:"intro",status:"completed"}).$promise}]},this.readGuideResolver=function(){return["$stateParams","pipRest",function(e,t){return t.guides().get({id:e.id||"55bf23d3bb22aa175c3e498e"}).$promise}]},this.$get=["pipRest","$stateParams","pipDataModel",function(e,t,n){return{partyId:e.partyId,updateGuide:function(e,t,r){e.resource="guides",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,t,r)},readGuides:function(r,i,a){return r.resource="guides",r.party_id=e.partyId(t),r.type="intro",n.read(r,i,a)},createGuideWithFiles:function(e,t,r){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="guides",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.create(e,t,r)})},updateGuideWithFiles:function(e,t,r){e.skipTransactionEnd=!0,n.saveFiles(e,function(){e.resource="guides",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.update(e,t,r)})},createGuide:function(e,t,r){e.resource="guides",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,n.create(e,t,r)},deleteGuide:function(e,t,r){e.resource="guides",n.remove(e,t,r)}}}]})}(),function(){"use strict";var e=angular.module("pipImageSetsData",["pipRest","pipDataModel"]);e.provider("pipImageSetsData",function(){var e=15;this.readImageSetsResolver=function(){return["$stateParams","pipRest",function(t,n){return n.image_sets().get({paging:1,skip:0,take:e,search:t.search}).$promise}]},this.readImageSetResolver=function(){return["$stateParams","pipRest",function(e,t){return t.image_sets().get({id:e.id}).$promise}]},this.$get=["pipRest","$stateParams","pipDataModel",function(t,n,r){return{partyId:t.partyId,readImageSets:function(i,a,o,s){i.resource="image_sets",i.skipTransactionBegin=!0,i.skipTransactionEnd=!1,i.item.search=n.search||i.item.search,i.item.party_id=t.partyId(n),i.item.take=e,i.item.paging=1,r.page(i,o,s)},updateImageSet:function(e,t,n){e.resource="image_sets",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,r.update(e,t,n)},createImageSet:function(e,t,n){e.resource="image_sets",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,r.create(e,t,n)},createImageSetWithFiles:function(e,t,n){e.skipTransactionEnd=!0,r.saveFiles(e,function(){e.resource="image_sets",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,r.create(e,t,n)})},updateImageSetWithFiles:function(e,t,n){e.skipTransactionEnd=!0,r.saveFiles(e,function(){e.resource="image_sets",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,r.update(e,t,n)})},deleteImageSet:function(e,t,n){e.resource="image_sets",r.remove(e,t,n)}}}]})}(),function(){"use strict";var e=angular.module("pipSessionData",["pipRest","pipSessionCache"]);e.provider("pipSessionData",function(){function e(e){return e.readUser()}function t(e,t){return e.readParty(t)}function n(e,t){return e.readConnection(t)}function r(e){return e.readSettings()}function i(e,t,n){return t.userSessions().query({party_id:e.id}).$promise}function a(e,t){return t.sessionId()}e.$inject=["pipSessionCache"],t.$inject=["pipSessionCache","$stateParams"],n.$inject=["pipSessionCache","$stateParams"],r.$inject=["pipSessionCache"],i.$inject=["$stateParams","pipRest","$rootScope"],a.$inject=["$stateParams","pipSession"],this.readUserResolver=e,this.readPartyResolver=t,this.readConnectionResolver=n,this.readSettingsResolver=r,this.readSessionsUserResolver=i,this.readSessionIdResolver=a,this.$get=["$rootScope","$stateParams","pipRest",function(e,t,n){function r(e){return function(){return e.sessionId()}}function i(e,r,i,a){var o=e.begin("REMOVING");o&&n.userSessions().remove({id:r.id,party_id:t.id},function(t){e.aborted(o)||(e.end(),i&&i(t))},function(t){e.end(t),a&&a(t)})}return{getSessionId:r,removeSession:i}}]})}(),function(){"use strict";var e=angular.module("pipSettingsData",["pipRest","pipSessionData","pipSessionCache","pipDataModel"]);e.provider("pipSettingsData",["pipSessionDataProvider",function(e){this.readSettingsResolver=e.readSettingsResolver,this.$get=["$rootScope","$stateParams","pipRest","pipSessionCache","pipSession","pipDataModel",function(e,t,n,r,i,a){function o(e,t){return r.readSettings(e,t)}function s(e,t){n.partySettings().get({party_id:i.userId()},function(t){t=t||{},r.onSettingsUpdate(t),e&&e(t)},t)}function u(t,n,o,s){t=n?_.pick(t,n):t,t.party_id=i.userId();var u=_.cloneDeep(e.$settings);r.onSettingsUpdate(t);var c={};c.resource="partySettings",c.item=t,c.item.creator_id=i.userId(),a.create(c,o,function(e){r.onSettingsUpdate(u),s&&s(e)})}return{saveSettings:u,readSettings:o,reReadSettings:s}}]}])}(),function(){"use strict";var e=angular.module("pipTagsData",["pipRest","pipDataModel","pipTagsCache"]);e.provider("pipTagsData",function(){this.readTagsResolver=function(){return["$stateParams","pipRest","pipTagsCache",function(e,t,n){return n.readTags({item:{party_id:t.partyId(e)}})}]},this.$get=["$stateParams","$state","pipRest","pipDataModel","pipTagsCache",function(e,t,n,r,i){return{partyId:n.partyId,readTags:function(e,t,n){i.readTags(e,t,n)}}}]})}(),function(){"use strict";var e=angular.module("pipTipsData",["pipRest","pipDataModel"]);e.provider("pipTipsData",function(){var e=100;this.readTipsResolver=function(){return["$stateParams","pipRest",function(e,t){return t.tips().query().$promise}]},this.readTipResolver=function(){return["$stateParams","pipRest",function(e,t){return t.tips().get({id:e.id}).$promise}]},this.$get=["pipRest","$stateParams","pipDataModel",function(t,n,r){return{partyId:t.partyId,readTips:function(i,a,o,s){return i.resource="tips",i.skipTransactionBegin=!0,i.skipTransactionEnd=!1,i.item.search=n.search,i.item.tags=n.search,i.item.party_id=t.partyId(n),i.item.take=e,i.item.paging=1,r.page(i,o,s)},updateTip:function(e,t,n){e.resource="tips",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,r.update(e,t,n)},createTip:function(e,t,n){e.resource="tips",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,r.create(e,t,n)},createTipWithFiles:function(e,t,n){e.skipTransactionEnd=!0,r.saveFiles(e,function(){e.resource="tips",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,r.create(e,t,n)})},updateTipWithFiles:function(e,t,n){e.skipTransactionEnd=!0,r.saveFiles(e,function(){e.resource="tips",e.skipTransactionBegin=!0,e.skipTransactionEnd=!1,r.update(e,t,n)})},deleteTip:function(e,t,n){e.resource="tips",r.remove(e,t,n)}}}]})}(),function(){"use strict";var e=angular.module("pipUsersData",["pipRest"]);e.provider("pipUsersData",function(){this.readUsersResolver=function(){return["$stateParams","pipRest",function(e,t){return t.users().page({party_id:e.id,paging:e.paging||1,skip:e.skip||0,take:e.take||15}).$promise}]},this.readUserResolver=function(){return["$stateParams","pipRest",function(e,t){return t.users().get({id:e.id,party_id:t.partyId(e)}).$promise}]},this.readActivitiesUserResolver=["$stateParams","pipRest","$rootScope",function(e,t,n){return t.partyActivities().page({party_id:n.$user.id,paging:1,skip:0,take:25}).$promise}],this.$get=["pipRest","$stateParams",function(e,t){return{partyId:e.partyId,readUsers:function(n,r,i,a){e.users().page({party_id:e.partyId(t),paging:1,skip:n.start,search:n.item.search,active:n.item.active,paid:n.item.paid,admin:n.item.admin,take:15},function(e){i&&i(e)},function(e){a(e)})},updateUser:function(t,n,r,i){e.users().update(t.item,function(e){r&&r(e)},function(e){i(e)})}}}]})}(),function(){"use strict";var e=angular.module("pipRest.Access",["pipUtils","pipRest.Enums"]);e.factory("pipAccess",["pipUtils","pipEnums",function(e,t){function n(e){var n=_.defaults({id:e.id||e._id,party_id:null,party_name:null,type:null,owner:!1,manager:!1,contributor:!1,share_level:t.SHARE_LEVEL.WORLD},e);return delete n._id,n}function r(e){return e.manager=e.manager||e.owner,e.contributor=e.contributor||e.manager,e.contributor&&(e.share_level=t.SHARE_LEVEL.PRIVATE),e}function i(e,n){return e.party_id=n.party_id,e.party_name=n.party_name,e.type=n.type,e.owner=!!n.owner,e.manager=!!n.manager,e.contributor=!!n.contributor,e.share_level=n.share_level||t.SHARE_LEVEL.WORLD,n.party&&(e.party_id=n.party.id||n.party._id,e.party_name=n.party.name),r(e)}function a(e){if(null!=e){var r=n(e);return r.party_id=r.id,r.party_name=r.name,r.type=null,r.owner=!0,r.manager=!0,r.contributor=!0,r.share_level=t.SHARE_LEVEL.PRIVATE,r}}function o(t,i){if(null!=t){if(null==i)return a(t);var o=t.id||t._id,s=i.id||i._id||i,u=i.name||t.name;if(o==s)return a(t);var c=n(t);return c.party_id=s,c.party_name=u,_.each(c.party_access,function(t){e.equalObjectIds(s,t.party_id)&&(c.party_name=t.party_name,c.type=t.type,c.manager=c.manager||t.manager,c.contributor=c.contributor||t.contributor,c.share_level=Math.max(c.share_level,t.share_level))}),r(c)}}function s(e,t){if(null!=e){var r=n(e);return t&&i(r,t),r}}function u(e,t,n){var r=o(e,t);return n&&i(r,n),r}return{asOwner:a,toParty:o,override:s,toPartyWithOverride:u}}])}(),function(){"use strict";var e=angular.module("pipRest.State",["pipState","pipRest.Session","pipRest.Access","pipSessionCache"]);e.config(["$locationProvider","$httpProvider",function(e,t){t.interceptors.push("pipAuthHttpResponseInterceptor")}]),e.run(["$rootScope","pipState","pipSession","pipAuthState",function(e,t,n,r){function i(i,a,o,s,u){if(!r.redirect(i,a,o,e)){if((a.auth||void 0===a.auth)&&!n.opened()){i.preventDefault();var c=t.href(a.name,o);return c.length>0&&"#"==c[0]&&(c=c.substring(1)),void r.goToSignin({redirect_to:c,toState:a,toParams:o})}return a.name==r.signoutState()?(i.preventDefault(),n.signout(),void r.goToUnauthorized({})):a.name==r.unauthorizedState()&&n.opened()?(i.preventDefault(),void r.goToAuthorized({})):void 0}}function a(e,t){n.close(),r.goToSignin(t)}function o(e,t){r.goToErrors("errors_maintenance",t)}function s(e,t){r.goToErrors("errors_no_connection",t)}function u(e,t){r.goToErrors("errors_missing_route",t)}function c(e,t){r.goToErrors("errors_unknown",t)}e.$on("$stateChangeStart",i),e.$on("pipUnauthorizedRedirect",a),e.$on("pipMaintenanceError",o),e.$on("pipNoConnectionError",s),e.$on("pipMissingRouteError",u),e.$on("pipUnknownError",c)}]),e.factory("pipAuthHttpResponseInterceptor",["$q","$location","$rootScope",function(e,t,n){return{response:function(t){return 401===t.status&&console.error("Response 401"),t||e.when(t)},responseError:function(r){var i=n.$state&&n.$state.name?n.$state.name:null,a=n.$state&&n.$state.params?n.$state.params:null;switch(r.status){case 401:case 440:console.error("Response Error 401",r),n.$emit("pipUnauthorizedRedirect",{redirect_to:i&&a&&a.redirect_to?"":t.url(),toState:i,toParams:a});break;case 503:n.$emit("pipMaintenanceError",{error:r}),console.error("errors_maintenance",r);break;case-1:console.error("errors_no_connection",r);break;default:console.error("errors_unknown",r)}return e.reject(r)}}}]),e.provider("pipAuthState",["pipStateProvider",function(e){function t(e){return e&&(p=e),p}function n(e){return e&&(d=e),d}function r(e){return e&&(E=e),E}function i(e){return e&&(l=e),l}function a(t,n){if(null==t)throw new Error("stateName cannot be null");if(null==n)throw new Error("stateConfig cannot be null");return(n.auth||n.authenticate)&&(n.resolve=n.resolve||{},n.resolve.user=o,n.resolve.party=s,n.resolve.connection=u,n.resolve.setting=c),e.state(t,n),this}function o(e){return e.readUser()}function s(e,t){return e.readParty(t)}function u(e,t){return e.readConnection(t)}function c(e){return e.readSettings()}o.$inject=["pipSessionCache"],s.$inject=["pipSessionCache","$stateParams"],u.$inject=["pipSessionCache","$stateParams"],c.$inject=["pipSessionCache"];var p=null,d=null,E="/",l="/";this.signinState=t,this.signoutState=n,this.authorizedState=r,this.unauthorizedState=i,this.redirect=e.redirect,this.state=a,this.$get=["pipState",function(e){return e.signinState=function(){return p},e.signoutState=function(){return d},e.authorizedState=function(){return E},e.unauthorizedState=function(){return l},e.goToErrors=function(t,n){if(null==t)throw new Error("Error state was not defined");e.go(t,n)},e.goToSignin=function(t){if(null==p)throw new Error("Signin state was not defined");e.go(p,t)},e.goToSignout=function(t){if(null==d)throw new Error("Signout state was not defined");e.go(d,t)},e.goToAuthorized=function(t){if(null==E)throw new Error("Authorized state was not defined");e.go(E,t)},e.goToUnauthorized=function(t){if(null==l)throw new Error("Unauthorized state was not defined");e.go(l,t)},e}]}])}(),function(){"use strict";var e=angular.module("pipRest.Enums",[]);e.factory("pipEnums",function(){function e(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}var t={};return t.SHARE_LEVEL={WORLD:0,OUTER:1,INNER:2,PRIVATE:3},t.URGENCY={LOW:1,NORMAL:500,HIGH:1e3,MIN:0,MAX:1e3},t.URGENCIES=e(t.URGENCY),t.IMPORTANCE={LOW:1,NORMAL:500,HIGH:1e3,MIN:0,MAX:1e3},t.IMPORTANCES=e(t.IMPORTANCE),t.CONFIDENTIALITY={PUBLIC:0,SENSITIVE:1,CLASSIFIED:2,SECRET:3},t.CONFIDENTIALITIES=e(t.CONFIDENTIALITY),t.LEVEL={NONE:0,LOW:1,LOW_MEDIUM:250,MEDIUM:500,MEDIUM_HIGH:750,HIGH:1e3,MIN:0,MAX:1e3},t.LANGUAGE={ENGLISH:"en",SPANISH:"es",PORTUGUESE:"pt",FRENCH:"fr",GERMAN:"de",RUSSIAN:"ru"},t.LANGUAGES=e(t.LANGUAGE),t.STAT_TYPE={DAILY:"daily",MONTHLY:"monthly",YEARLY:"yearly",TOTAL:"total"},t.STAT_TYPES=e(t.STAT_TYPE),t.STAT_BATCH_OPERATION={RECORD_SYSTEM_STATS:"record system stats",RECORD_PARTY_STATS:"record party stats"},t.SERVER_TYPE={REALTIME_DB:"r/t db master",HISTORIAN_DB:"db slave",ANALYTICS:"analytics",BUSINESS_LOGIC:"business logic",REST_API:"rest api",STATIC_CONTENT:"static content",BACKUP_STORAGE:"backup storage"},t.SERVER_TYPES=e(t.SERVER_TYPE),t.SYSTEM_LOG_TYPE={INFO:"info",STOP:"stop",START:"start",RESTART:"restart",UPGRADE:"upgrade",MAINTENANCE:"maintenance",WARNING:"warning",ERROR:"error"},t.SYSTEM_LOG_TYPES=e(t.SYSTEM_LOG_TYPE),t.ACTIVITY_TYPE={SIGNUP:"signup",SIGNIN:"signin",PASSWORD_CHANGED:"password changed",PWD_RECOVERED:"pwd recovered",EMAIL_VERIFIED:"email verified",SETTINGS_CHANGED:"settings changed",PARTNERED:"partnered",TEAMED_UP:"teamed up",FOLLOWED:"followed",DISCONNECTED:"disconnected",CREATED:"created",UPDATED:"updated",DELETED:"deleted",ACCEPTED:"accepted",REJECTED:"rejected",JOINED:"joined",COMPLETED:"completed",CANCELED:"canceled",PROGRESS:"progress",POSTED:"posted",BUZZED:"buzzed",COMMENTED:"commented",CHEERED:"cheered",BOOED:"booed"},t.ACTIVITY_TYPES=e(t.ACTIVITY_TYPE),t.REFERENCE_TYPE={PARTY:"party",CONNECTION:"connection",CONTACT:"contact",MESSAGE:"message",NOTE:"note",AREA:"area",GOAL:"goal",EVENT:"event",VISION:"vision",COLLAGE:"collage",POST:"post",SUPPORT_CASE:"support case",ANNOUNCE:"announce",IMAGE_SET:"image set",FEEDBACK:"feedback",GUIDE:"guide"},t.REFERENCE_TYPES=e(t.REFERENCE_TYPE),t.CONTENT_TYPE={TEXT:"text",CHECKLIST:"checklist",LOCATION:"location",TIME:"time",PICTURES:"pictures",DOCUMENTS:"documents"},t.CONTENT_TYPES=e(t.CONTENT_TYPE),t.PARTY_TYPE={PERSON:"person",TEAM:"team",AGENT:"agent"},t.PARTY_TYPES=e(t.PARTY_TYPE),t.GENDER={MALE:"male",FEMALE:"female",NOT_SPECIFIED:"n/s"},t.GENDERS=e(t.GENDER),t.VISION_TYPE={OVERALL:"overall",ROLE:"role",MODEL:"model",TIME:"time"},t.VISION_TYPES=e(t.VISION_TYPE),t.AREA_TYPE={CATEGORY:"category",AREA:"area"},t.AREA_TYPES=e(t.AREA_TYPE),t.GOAL_TYPE={GOAL:"goal",OBJECTIVE:"objective",DREAM:"dream",ACCOMPLISHMENT:"accomplishment",TASK:"task",ROUTINE:"routine"},t.GOAL_TYPES=e(t.GOAL_TYPE),t.PROCESS_NODE={START:"start",END:"end",EVENT:"event",AWAIT:"await",DECISION:"decision",ACTIVITY:"activity"},t.PROCESS_NODES=e(t.PROCESS_NODE),t.CALCULATION_METHOD={LAST_VALUE:"last value",SUM:"sum",MAX:"max",MIN:"min",AVERAGE:"average"},t.CALCULATION_METHODS=e(t.CALCULATION_METHOD),t.EXECUTION_STATUS={NEW:"new",ASSIGNED:"assigned",IN_PROGRESS:"in progress",VERIFYING:"verifying",ON_HOLD:"on hold",CANCELED:"canceled",COMPLETED:"completed"},t.EXECUTION_STATUSES=e(t.EXECUTION_STATUS),t.CONTRIBUTOR_ROLE={UNDEFINED:"undefined",RESPONSIBLE:"responsible",ACCOUNTABLE:"accountable",CONSULTED:"consulted",INFORMED:"informed"},t.CONSTRIBUTOR_ROLES=e(t.CONTRIBUTOR_ROLE),t.ACCEPTANCE={JOINED:"joined",INVITED:"invited",ACCEPTED:"accepted"},t.ACCEPTANCES=e(t.ACCEPTANCE),t.ACCEPT_ACTION={INVITE:"invite",JOIN:"join",ACCEPT:"accept",REJECT:"reject"},t.ACCEPT_ACTIONS=e(t.ACCEPT_ACTION),t.JOIN_METHOD={INVITE:"invite",APPROVE:"approve",OPEN:"open"},t.JOIN_METHODS=e(t.JOIN_METHOD),t.SKILL_LEVEL={NOVICE:"novice",INTERMEDIATE:"intermediate",ADVANCED:"advanced",EXPERT:"expert"},t.SKILL_LEVELS=e(t.SKILL_LEVEL),t.FEEDBACK_TYPE={SUPPORT:"support",TEAM:"team",MEETUP:"meetup",COPYRIGHT:"copyright",BUSINESS:"business",ADVERTISEMENT:"ad"},t.FEEDBACK_TYPES=e(t.FEEDBACK_TYPE),t.NOTE_CATEGORY={GENERAL:"general",UNFINISHED:"unfinished",ULTIMATE_TODO:"ultimate todo"},t.NOTE_CATEGORIES=e(t.NOTE_CATEGORY),t.CONNECTION_TYPE={PARTNER:"partner",MEMBER:"member",FOLLOW:"follow",AUTOMATION:"automation"},t.CONNECTION_TYPES=e(t.CONNECTION_TYPE),t.EVENT_TYPE={INSTANCE:"instance",RECURRENCE:"recurrence",AUTO_INSTANCE:"auto",TIME_ENTRY:"time entry"},t.EVENT_TYPES=e(t.EVENT_TYPE),t.EVENT_CATEGORY={DAILY:"daily",WEEKLY:"weekly",MONTHLY:"monthly",YEARLY:"yearly"},t.EVENT_CATEGORIES=e(t.EVENT_CATEGORY),t.COMMENT_TYPE={BUZZ:"buzz",CHEER:"cheer",BOO:"boo",COMMENT:"comment"},t.COMMENT_TYPES=e(t.COMMENT_TYPE),t.POST_TYPE={INFO:"info",QUESTION:"question",ISSUE:"issue",REPORT:"report",FORECAST:"forecast"},t.POST_TYPES=e(t.POST_TYPE),t.MESSAGE_TYPE={REGULAR:"regular",EMAIL:"email",INVITATION:"invitation"},t.MESSAGE_TYPES=e(t.MESSAGE_TYPE),t.NOTIFICATION_TYPE={GREETING:"greeting",MESSAGE:"message",PARTNER_INVITE:"partner invite",PARTNER_RESPONSE_ACCEPTED:"partner response accepted",PARTNER_RESPONSE_REJECTED:"partner response rejected",PARTNER_JOINED:"partner joined",MEMBER_INVITE:"member invite",MEMBER_REQUEST:"member request",MEMBER_RESPONSE_ACCEPTED:"member response accepted",MEMBER_RESPONSE_REJECTED:"member response rejected",MEMBER_JOINED:"member joined",FOLLOWER_JOINED:"follower joined",ENTITY_REQUEST:"entity request",ENTITY_REQUEST_ACCEPTED:"entity request accepted",ENTITY_REQUEST_REJECTED:"entity request rejected",ENTITY_INVITE:"entity invite",ENTITY_INVITE_ACCEPTED:"entity invite accepted",ENTITY_INVITE_REJECTED:"entity invite rejected",ENTITY_JOINED:"entity joined",VERIFY_EMAIL:"verify email",COMPLETE_PROFILE:"complete profile"},t.NOTIFICATION_TYPES=e(t.NOTIFICATION_TYPE),t.NOTIFICATION_BATCH_OPERATION={CREATE:"create",REPLY:"reply",CLOSE:"close",DELETE:"delete"},t.SUPPORT_CASE_CATEGORY={ACCOUNT:"account",BILLING:"billing",TECHNICAL:"technical",GENERAL:"general"},t.SUPPORT_CASE_CATEGORIES=e(t.SUPPORT_CASE_CATEGORY),t.ANNOUNCE_TYPE={APP:"app",EMAIL:"email",APP_AND_EMAIL:"app and email"},t.ANNOUNCE_TYPES=e(t.ANNOUNCE_TYPE),t.ANNOUNCE_CATEGORY={GENERAL:"general",MAINTENANCE:"maintenance",NEW_RELEASE:"new release",SURVEY:"survey"},t.ANNOUNCE_CATEGORIES=e(t.ANNOUNCE_CATEGORY),t.GUIDE_TYPE={INTRO:"intro",TOPIC:"topic",CONTEXT:"context",TIP:"tip",NEW_RELEASE:"new release"},t.GUIDE_TYPES=e(t.GUIDE_TYPE),t.EMAIL_TYPE={HOME:"home",WORK:"work",OTHER:"other"},t.EMAIL_TYPES=e(t.EMAIL_TYPE),t.ADDRESS_TYPE={HOME:"home",WORK:"work",OTHER:"other"},t.ADDRESS_TYPES=e(t.ADDRESS_TYPE),t.ADDRESS_TYPE={HOME:"home",WORK:"work",OTHER:"other"},t.ADDRESS_TYPES=e(t.ADDRESS_TYPE),t.PHONE_TYPE={MOBILE:"mobile",WORK:"work",HOME:"home",MAIN:"main",WORK_FAX:"work fax",HOME_FAX:"home fax",OTHER:"other"},t.PHONE_TYPES=e(t.PHONE_TYPE),t.MESSANGER_TYPE={SKYPE:"skype",GOOGLE_TALK:"google talk",AIM:"aim",YAHOO:"yahoo",QQ:"qq",MSN:"msn",ICQ:"icq",JABBER:"jabber",OTHER:"other"},t.MESSANGER_TYPES=e(t.MESSANGER_TYPE),t.WEB_ADDRESS_TYPE={PROFILE:"profile",BLOG:"blog",HOME_PAGE:"home page",WORK:"work",PORTFOLIO:"portfolio",OTHER:"other"},t.WEB_ADDRESS_TYPES=e(t.WEB_ADDRESS_TYPE),t.DASHBOARD_TILE_SIZE={SMALL:"small",WIDE:"wide",LARGE:"large"},t.DASHBOARD_TILE_SIZES=e(t.DASHBOARD_TILE_SIZE),t})}(),function(){"use strict";var e=angular.module("pipRest",["ngResource","pipRest.Enums","pipRest.Access","pipRest.Session","pipRest.State"]);
e.provider("pipRest",["$httpProvider",function(e){function t(e){for(var t in e)i[t]=e[t]}var n="",r=!1,i=[];this.addApi=t,e.defaults.headers.common["api-version"]="1.0",this.version=function(t){return t&&(e.defaults.headers.common["api-version"]=t),e.defaults.headers.common["api-version"]},this.serverUrlFixed=function(e){return e!==!0&&"on"!==e||(r=e),r},this.serverUrl=function(e){return e&&(n=e),e},this.$get=["$rootScope","$http","$resource",function(t,a,o){function s(e,t,r,i){return e=e||n,o(e+t,r,i)}function u(e,t){return e=e||n,o(e+t,{},{call:{method:"POST"}})}function c(e,t,r){return e=e||n,o(e+t,r||{id:"@id"},{update:{method:"PUT"}})}function p(e,t,r){return e=e||n,o(e+t,r||{id:"@id"},{page:{method:"GET",isArray:!1},update:{method:"PUT"}})}function d(e,t,n){return p(e,t,n||{id:"@id",party_id:"@party_id"})}function E(){for(var e in i)l[e]=i[e]}var l={version:function(t){return t&&(e.defaults.headers.common["api-version"]=t),e.defaults.headers.common["api-version"]},serverUrl:function(e){return e&&(n=e),n},userId:function(){return a.defaults.headers.common["user-id"]},serverUrlFixed:function(){return r},sessionId:function(){return a.defaults.headers.common["session-id"]},partyId:function(e){return e.party_id||a.defaults.headers.common["user-id"]},about:function(e){return s(e,"/api/about")},session:function(e,t){a.defaults.headers.common["session-id"]=t,a.defaults.headers.common["user-id"]=e},signin:function(e){return u(e,"/api/signin")},signout:function(e){return u(e,"/api/signout")},signup:function(e){return u(e,"/api/signup")},recoverPassword:function(e){return u(e,"/api/recover_password")},resetPassword:function(e){return u(e,"/api/reset_password")},changePassword:function(e){return u(e,"/api/change_password")},requestEmailVerification:function(e){return c(e,"/api/users/:party_id/resend_email_verification")},verifyEmail:function(e){return u(e,"/api/verify_email")},signupValidate:function(e){return u(e,"/api/signup_validate")},users:function(e){return p(e,"/api/users/:id")},currentUser:function(e){return s(e,"/api/users/current",{},{get:{method:"GET",isArray:!1}})},userSessions:function(e){return d(e,"/api/users/:party_id/sessions/:id")},parties:function(e){return p(e,"/api/parties/:id")},partySettings:function(e){return d(e,"/api/parties/:party_id/settings")},serverActivities:function(e){return p(e,"/api/servers/activities/:id")},connections:function(e){return d(e,"/api/parties/:party_id/connections/:id")},guides:function(e){return p(e,"/api/guides/:id")},tips:function(e){return p(e,"/api/tips/:id")},image_sets:function(e){return p(e,"/api/image_sets/:id")},images:function(e){return p(e,"/api/images/search")},feedbacks:function(e){return d(e,"/api/feedbacks/:id")},announces:function(e){return p(e,"/api/announcements/:id")},createResource:s,createOperation:u,createCollection:c,createPagedCollection:p,createPartyCollection:d};return E(),l}]}])}(),function(){"use strict";var e=angular.module("pipRest.Session",["ngCookies","pipRest"]);e.run(["pipSession",function(e){e.reopen()}]),e.factory("pipSession",["$rootScope","$http","localStorageService","$cookieStore","pipRest","pipTimer",function(e,t,n,r,i,a){function o(){return R}function s(){return g}function u(){return v||n.get("serverUrl")}function c(){var e=""!==g&&null!==g&&void 0!==g&&""!==R&&null!==R&&void 0!==R&&""!==v&&null!==v&&void 0!==v;return e}function p(e){var t=n.get("servers");return t&&t[e]?t[e].email:void 0}function d(){return n.get("servers")||{}}function E(){var e,t=n.get("servers"),r=[];for(var i in t)t.hasOwnProperty(i)&&(e=t[i].serverUrl,e&&r.push(e));return r}function l(n,r,a){var o=n.serverUrl,s=n.email,u=n.password,c=n.remember,p=!!n.adminOnly,d=(new Date).getTime();I=d,t.defaults.headers.common["session-id"]=void 0,t.defaults.headers.common["user-id"]=void 0,t.defaults.headers.common["account-id"]=void 0,i.signin(o).call({email:s,password:u,remember:c},function(t){I==d&&(I=void 0,p&&!t.admin?a("ERROR_ADMIN_ONLY_ACCESS"):(m(o,t,c),e.$broadcast("pipAutoPullChanges"),r(t)))},function(e){I==d&&(I=void 0,a(e))})}function T(){I=void 0}function f(e){c()&&i.signout().call({},e,e),_()}function m(o,s,u){if(g=s.last_session_id,R=s.id,v=o,t.defaults.headers.common["session-id"]=g,t.defaults.headers.common["user-id"]=R,u){var c=n.get("servers")||{};c[v]={serverUrl:v,email:s.email},n.set("servers",c),n.set("sessionId",g),n.set("userId",R),n.set("serverUrl",v)}r.put("user-id",R),r.put("session-id",g),r.put("server-url",v),i.serverUrlFixed()||i.serverUrl(v),e.$emit("pipSessionOpened",{serverUrl:v,sessionId:g,userId:R,user:s}),a.start()}function S(){R=r.get("user-id")||n.get("userId"),g=r.get("session-id")||n.get("sessionId"),v=r.get("server-url")||n.get("serverUrl"),t.defaults.headers.common["session-id"]=g,t.defaults.headers.common["user-id"]=R,i.serverUrlFixed()&&i.serverUrl()||i.serverUrl(v),e.$serverUrl=i.serverUrl(),e.$emit("pipSessionOpened",{serverUrl:v,sessionId:g,userId:R})}function _(){g=void 0,R=void 0,t.defaults.headers.common["session-id"]=void 0,t.defaults.headers.common["user-id"]=void 0,n.remove("userId"),n.remove("sessionId"),r.remove("user-id"),r.remove("session-id"),a.stop(),e.$emit("pipSessionClosed")}var g,R,v,I=void 0;return{opened:c,userId:o,sessionId:s,serverUrl:u,lastUsedEmail:p,usedServers:d,usedServerUrls:E,signin:l,abort:T,signout:f,open:m,close:_,reopen:S}}])}();